<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Test DELETE</title>
  <link rel="stylesheet" href="/assets/theme.css">
</head>
<body>
  <main class="card card--medium">
    <div class="card-content">
      <div class="pill">HTTP DELETE sandbox</div>
      <h1 class="hero-title"><span>ğŸ—‘ï¸</span> Test DELETE sur /uploads/</h1>
      <p class="subtitle">DÃ©clenchez des requÃªtes DELETE cÃ´tÃ© client afin de vÃ©rifier la bonne gestion des suppressions dans le serveur.</p>

      <section class="stack">
        <label for="fname"><strong>Fichier Ã  manipuler</strong> (relatif Ã  <code>/uploads/</code>)</label>
        <input id="fname" type="text" value="todel.txt" aria-label="Nom de fichier">
        <div class="actions">
          <button id="delBtn" type="button" class="btn">Supprimer via DELETE</button>
          <button id="checkBtn" type="button" class="btn">VÃ©rifier via GET</button>
          <button id="mkBtn" type="button" class="btn">Guide crÃ©ation fichier</button>
          <a id="fileLink" class="btn" href="#" target="_blank">Ouvrir le fichier</a>
        </div>
        <p class="muted">RequÃªte ciblÃ©e : <code id="show">/uploads/todel.txt</code></p>
        <pre id="out">Actions et rÃ©ponses serveur sâ€™afficheront ici.</pre>
      </section>

      <p class="muted">
        AstuceÂ : crÃ©ez un fichier de test depuis votre terminal&nbsp;:
        <code>echo "hello" &gt; www/html/uploads/todel.txt</code> puis utilisez les boutons ci-dessus pour tester GET/DELETE.
      </p>
    </div>
  </main>
  <script>
const fname = document.getElementById('fname');
const show = document.getElementById('show');
const out = document.getElementById('out');
const link = document.getElementById('fileLink');
const delBtn = document.getElementById('delBtn');
const checkBtn = document.getElementById('checkBtn');
const mkBtn = document.getElementById('mkBtn');

function uri() {
  return '/uploads/' + fname.value.replace(/^\/+/, '');
}
function syncUI(){
  show.textContent = uri();
  link.href = uri();
}
fname.addEventListener('input', syncUI);
syncUI();

delBtn.addEventListener('click', async () => {
  out.textContent = 'Envoi DELETE...';
  const url = uri();
  try {
    const r = await fetch(url, { method: 'DELETE' });
    out.textContent = 'DELETE ' + url + '\nStatus: ' + r.status + ' ' + (r.statusText||'') +
                      '\nContent-Length: ' + (r.headers.get('content-length')||'');
  } catch(e) {
    out.textContent = 'Erreur: ' + e;
  }
});

checkBtn.addEventListener('click', async () => {
  out.textContent = 'VÃ©rification GET...';
  const url = uri();
  try {
    const r = await fetch(url, { method:'GET' });
    out.textContent = 'GET ' + url + '\nStatus: ' + r.status + ' ' + (r.statusText||'');
    if (r.ok) out.textContent += '\nAperÃ§u: ' + (await r.text()).slice(0,200);
  } catch(e) {
    out.textContent = 'Erreur: ' + e;
  }
});

mkBtn.addEventListener('click', () => {
  out.textContent = 'Pour crÃ©er un fichier de test, utilisez votre terminal:\n'
    + 'echo "hello" > www/html/uploads/' + fname.value.replace(/\s+/g,'') + '\n'
    + 'puis testez GET/DELETE ci-dessus.';
});
</script>
</body>
</html>
