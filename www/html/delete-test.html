<!doctype html>
<meta charset="utf-8">
<title>Test DELETE</title>
<style>
  body{font-family:system-ui,Arial,sans-serif;margin:2rem;line-height:1.5}
  input,button{font-size:1rem}
  pre{background:#f6f8fa;padding:1rem;border-radius:6px;overflow:auto}
</style>
<h1>Test DELETE</h1>
<p>Fichier à supprimer sous <code>/uploads/</code>:</p>
<input id="fname" value="todel.txt" aria-label="Nom de fichier">
<button id="delBtn" type="button">DELETE /uploads/<span id="show"></span></button>
<pre id="out"></pre>
<p>
  <a id="fileLink" href="#" target="_blank">Ouvrir le fichier (GET)</a>
  • <button id="checkBtn" type="button">Vérifier existence (GET)</button>
  • <button id="mkBtn" type="button">Créer fichier de test</button>
  <small>(créer côté serveur via POST n'est pas encore branché ici)</small>
  <br><small>Créez plutôt le fichier via terminal: <code>echo "hello" &gt; www/html/uploads/todel.txt</code></small>
  </p>
<script>
const fname = document.getElementById('fname');
const show = document.getElementById('show');
const out = document.getElementById('out');
const link = document.getElementById('fileLink');
const delBtn = document.getElementById('delBtn');
const checkBtn = document.getElementById('checkBtn');
const mkBtn = document.getElementById('mkBtn');

function uri() {
  return '/uploads/' + fname.value.replace(/^\/+/, '');
}
function syncUI(){
  show.textContent = fname.value;
  link.href = uri();
}
fname.addEventListener('input', syncUI);
syncUI();

delBtn.addEventListener('click', async () => {
  out.textContent = 'Envoi DELETE...';
  const url = uri();
  try {
    const r = await fetch(url, { method: 'DELETE' });
    out.textContent = 'DELETE ' + url + '\nStatus: ' + r.status + ' ' + (r.statusText||'') +
                      '\nContent-Length: ' + (r.headers.get('content-length')||'');
  } catch(e) {
    out.textContent = 'Erreur: ' + e;
  }
});

checkBtn.addEventListener('click', async () => {
  out.textContent = 'Vérification GET...';
  const url = uri();
  try {
    const r = await fetch(url, { method:'GET' });
    out.textContent = 'GET ' + url + '\nStatus: ' + r.status + ' ' + (r.statusText||'');
    if (r.ok) out.textContent += '\nAperçu: ' + (await r.text()).slice(0,200);
  } catch(e) {
    out.textContent = 'Erreur: ' + e;
  }
});

mkBtn.addEventListener('click', () => {
  out.textContent = 'Pour créer un fichier de test, utilisez votre terminal:\n'
    + 'echo "hello" > www/html/uploads/' + fname.value.replace(/\s+/g,'') + '\n'
    + 'puis testez GET/DELETE ci-dessus.';
});
</script>
